version: "1.0.0"
entry: router

prompts:
  GET_NAME_PROMPT: >
    You are a very friendly and experienced Sales Associate conducting a presale
    interview with a potential customer. The first question must be to gather
    the user's name. Once you get their name, greet them using their name.
    Example: 'Great to meet you, <name>! Make sure make the user feel special by
    not using tha standard packaged greating.'
  GET_COMPANY_PROMPT: >
    Ask the user for the name of the company they work for. Keep it brief and
    friendly. Confirm the name back to them.
  GET_USER_ROLE: >
    You are an experienced enterprise HR expert with a deep understanding of
    corporate structure, typical roles, and responsibilities. Ask the user what
    their role is in the organization, plus two additional questions about their
    main responsibilities. Use their name if available.
  IS_ROLE_CLEAR: >
    You are an experienced enterprise HR expert. Assess if the role and stated
    responsibilities match. If any doubt, the role is not clear. Respond with
    exactly 'Yes' or 'No'.
  ROLE_CLARIFY_Q1: >
    Ask one concise question that will help clarify the user's role
    responsibilities.
  ROLE_CLARIFY_Q2: >
    Ask one concise follow-up question that builds on the user's last answer to
    further clarify their role responsibilities.
  SUGGEST_ROLE: >
    You are an experienced enterprise HR expert. Based on the answers to the
    additional questions, determine and suggest the correct role for the user.
  CLOSING: >
    You are an experienced customer service representative with great personal
    skills. Thank the user for their time and give a friendly closing statement
    to finish the interview.

channels:
  messages: { type: array_append, default: [] }
  stage: { type: last }
  user_name: { type: last }
  role: { type: last }
  company_name: { type: last }
  persona_group: { type: last }
  goals: { type: array_append, default: [] }
  timing: { type: last }
  impact: { type: last }
  market_segment: { type: last }
  outcomes: { type: array_append, default: [] }
  role_clear: { type: last }
  suggested_role: { type: last }

nodes:
  get_name:
    kind: llm_prompt
    promptId: GET_NAME_PROMPT
    after: { stage: get_company }
  get_company:
    kind: llm_prompt
    promptId: GET_COMPANY_PROMPT
    after: { stage: get_role }
  get_role:
    kind: llm_prompt
    promptId: GET_USER_ROLE
    after: { stage: is_role_clear }
  is_role_clear:
    kind: llm_prompt_branch
    promptId: IS_ROLE_CLEAR
    matcher: includes_yes
    branches:
      yes:
        next: interview_closing_chain
        capture: { role_clear: response }
      no:
        next: clarify_role_q1
        capture: { role_clear: response }
  clarify_role_q1:
    kind: llm_prompt
    promptId: ROLE_CLARIFY_Q1
    after: { stage: clarify_role_q2 }
  clarify_role_q2:
    kind: llm_prompt
    promptId: ROLE_CLARIFY_Q2
    after: { stage: suggest_role }
  suggest_role:
    kind: llm_prompt
    promptId: SUGGEST_ROLE
    after: { stage: interview_closing }
    capture: { suggested_role: response }
  interview_closing:
    kind: llm_prompt
    promptId: CLOSING
    after: { stage: done }
  interview_closing_chain:
    kind: llm_chain
    steps:
      - promptId: CLOSING
        capture: null
    after: { stage: done }

edges:
  - { from: get_name, to: END }
  - { from: get_company, to: END }
  - { from: get_role, to: END }
  - { from: is_role_clear, to: END }
  - { from: clarify_role_q1, to: END }
  - { from: clarify_role_q2, to: END }
  - { from: suggest_role, to: END }
  - { from: interview_closing, to: END }
  - { from: interview_closing_chain, to: END }

router:
  entry: router
  defaultNext: get_name
  routes:
    get_name: get_name
    get_company: get_company
    get_role: get_role
    is_role_clear: is_role_clear
    clarify_role_q1: clarify_role_q1
    clarify_role_q2: clarify_role_q2
    suggest_role: suggest_role
    interview_closing: interview_closing
    interview_closing_chain: interview_closing_chain
    done: END